- mysql的架构是**单进程多线程的**，每个客户端都会拥有一个线程，这个连接的查询只会在这个单独的线程中执行.


# 第二章 innoDB存储引擎

## 2.4 Checkpoint技术 
- 当缓冲池数据页发生变化时,如果从缓冲池将数据页刷新到磁盘时发生宕机,那么数据就无法恢复.所以为了避免数据丢失问题,当前事务数据库系统普遍采用write ahead log策略, 即当事务提交时,先写重写日志,在修改页.当发生宕机时,通过重做日志来完成数据的恢复,这也是事务ACID中D(durability 持久性)的要求.
- **checkpoint(检查点)技术的目的是为了解决如下问题:**
  - 缩短数据库恢复时间
  - 缓冲池不够用时,将脏页刷新到磁盘上
  - 当重做日志不可用时,刷新脏页
当发生宕机后,数据库不需要重做所有的日志,因为checkpoint之前的页已经刷回到磁盘上,故数据库只需要将checkpoint后的重做日志进行恢复即可.  

## 2.6 innoDB关键特性
### 2.6.2 两次写
doublewrite(两次写)带给innoDB存储引擎的数据页的可靠性.试想宕机时,innoDB正将某个数据页写入到磁盘中,这个页只写了一部分,比如这个页16KB,但是只写了4KB就宕机.这就导致这个页损坏了.即使你后续想通过重做日志来恢复,也是没有意义的.所以需要一个副本,当脏数据页从缓冲刷新到磁盘上失败,那么可以用这个副本还原数据,然后再用重做日志来恢复.doublewrite由两部分组成,一部分是缓冲中doublewrite buffer,大小2MB,另一个物理磁盘上共享表空间中连续的128个页,即2个区(extent),大小也为2MB.所以运用了doublewrite技术的脏数据页刷新流程如下: 先将缓冲池中的脏数据页复制到内存中的doublewrite buffer上;然后将数据写到磁盘上的doublewrite,作为备份,因为磁盘上doublewrite页是顺序的所以开销不大;接着将doublewrite buffer中的页数据写入到实际的各个表空间文件中,此时写入则是离散.

